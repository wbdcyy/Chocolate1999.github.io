<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue 技术栈 手写响应式原理 到 探索设计模式 | 超逸の博客</title><meta name="description" content="Vue 技术栈 手写响应式原理 到 探索设计模式"><meta name="keywords" content="Vue,设计模式"><meta name="author" content="Yang Chao Yi"><meta name="copyright" content="Yang Chao Yi"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Vue 技术栈 手写响应式原理 到 探索设计模式"><meta name="twitter:description" content="Vue 技术栈 手写响应式原理 到 探索设计模式"><meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161739.webp"><meta property="og:type" content="article"><meta property="og:title" content="Vue 技术栈 手写响应式原理 到 探索设计模式"><meta property="og:url" content="https://yangchaoyi.vip/posts/37332/"><meta property="og:site_name" content="超逸の博客"><meta property="og:description" content="Vue 技术栈 手写响应式原理 到 探索设计模式"><meta property="og:image" content="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161739.webp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://yangchaoyi.vip/posts/37332/"><link rel="prev" title="前端知识梳理之webpack篇" href="https://yangchaoyi.vip/posts/20541/"><link rel="next" title="Hexo 添加加载动画" href="https://yangchaoyi.vip/posts/35726/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"yangchaoyi.vip","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Chocolate1999/cdn/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list" aria-hidden="true"></i><span> 媒体</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li><li><a class="site-page" href="/home/"><i class="fa-fw fab fa-phoenix-framework"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#写在开头"><span class="toc-number">1.</span> <span class="toc-text">写在开头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#学习目录"><span class="toc-number">2.</span> <span class="toc-text">学习目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正文"><span class="toc-number">3.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue-2的响应式原理"><span class="toc-number">3.1.</span> <span class="toc-text">Vue 2的响应式原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是defineProperty"><span class="toc-number">3.1.1.</span> <span class="toc-text">什么是defineProperty( )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get和set的使用"><span class="toc-number">3.1.2.</span> <span class="toc-text">get和set的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Vue中从改变一个数据到发生改变的过程"><span class="toc-number">3.1.3.</span> <span class="toc-text">Vue中从改变一个数据到发生改变的过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写-Vue-2-中响应式原理"><span class="toc-number">3.1.4.</span> <span class="toc-text">手写 Vue 2 中响应式原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#源码分析：响应式原理中的依赖收集"><span class="toc-number">3.1.5.</span> <span class="toc-text">源码分析：响应式原理中的依赖收集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对依赖收集的总结"><span class="toc-number">3.1.6.</span> <span class="toc-text">对依赖收集的总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#额外注意——关于数组的监听（探索设计模式）"><span class="toc-number">3.1.7.</span> <span class="toc-text">额外注意——关于数组的监听（探索设计模式）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue-3的响应式原理"><span class="toc-number">3.2.</span> <span class="toc-text">Vue 3的响应式原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是proxy"><span class="toc-number">3.2.1.</span> <span class="toc-text">什么是proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结：为什么Vue-3中使用proxy"><span class="toc-number">3.2.2.</span> <span class="toc-text">总结：为什么Vue 3中使用proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写-Vue-3-中响应式原理"><span class="toc-number">3.2.3.</span> <span class="toc-text">手写 Vue 3 中响应式原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy这么好用，还能做什么呢？（再遇设计模式）"><span class="toc-number">3.2.4.</span> <span class="toc-text">proxy这么好用，还能做什么呢？（再遇设计模式）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#virtual-dom-和-diff算法"><span class="toc-number">3.3.</span> <span class="toc-text">virtual dom 和 diff算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#虚拟dom"><span class="toc-number">3.3.1.</span> <span class="toc-text">虚拟dom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#diff算法的比对机制"><span class="toc-number">3.3.2.</span> <span class="toc-text">diff算法的比对机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161739.webp)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">超逸の博客</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list" aria-hidden="true"></i><span> 媒体</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li><li><a class="site-page" href="/home/"><i class="fa-fw fab fa-phoenix-framework"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Vue 技术栈 手写响应式原理 到 探索设计模式</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-05-04 11:45:19"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-05-04</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-05-04 11:58:14"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-05-04</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.4k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 17 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-comments" aria-hidden="true"></i><span>评论数:</span><a href="/posts/37332/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/posts/37332/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="写在开头"><a href="#写在开头" class="headerlink" title="写在开头"></a>写在开头</h2><p>学习完了ES 6基础，<a href="https://blog.csdn.net/weixin_42429718/article/details/104696830" target="_blank" rel="noopener">推荐阅读：ECMAScript 6 全套学习目录 整理 完结</a></p>
<p>现在开始逐步深入Vue 技术栈，想了想，技术栈专栏的主要内容包括：</p>
<p>1、Vue源码分析<br>2、手把手教 保姆级 撸代码<br>3、无惧面试，学以致用，继承创新<br>4、谈谈前端发展与学习心得<br>5、手写源码技术栈，附上详细注释<br>6、从源码中学习设计模式，一举两得<br>7、编程思想的提升及代码质量的提高<br>8、通过分析源码学习架构，看看优秀的框架<br>9、项目实战开发<br>10、面试准备，完善个人简历</p>
<hr/>

<p>暂时想到的就这么多，把这列举的10点做好了，我觉得也OK了，欢迎一起学习，觉得不错的话，可以关注博主，专栏会不断更新，可以关注一下，<a href="https://blog.csdn.net/weixin_42429718/category_9761758.html" target="_blank" rel="noopener">传送门~</a></p>
<h2 id="学习目录"><a href="#学习目录" class="headerlink" title="学习目录"></a>学习目录</h2><p>为了方便自己查阅与最后整合，还是打算整个目录，关于Vue技术栈前面的几篇优秀的文章：</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="Vue-2的响应式原理"><a href="#Vue-2的响应式原理" class="headerlink" title="Vue 2的响应式原理"></a>Vue 2的响应式原理</h3><hr/>

<p>提到Vue2的响应式原理，或许你就会想到<code>Object.defineProperty()</code>，但Object.defineProperty()严格来说的话，并不是来做响应式的。</p>
<h4 id="什么是defineProperty"><a href="#什么是defineProperty" class="headerlink" title="什么是defineProperty( )"></a>什么是defineProperty( )</h4><p><a href="https://blog.csdn.net/weixin_42429718/article/details/104472989" target="_blank" rel="noopener">推荐阅读：Vue 中 数据劫持 Object.defineProperty()</a></p>
<ul>
<li>defineProperty其实是定义对象的属性，或者你可以认为是对象的属性标签<blockquote>
<div>defineProperty其实并不是核心的为一个对象做数据双向绑定，而是去给对象做属性标签，只不过属性里的get和set实现了响应式</div>
</blockquote>
</li>
</ul>
<table>
<thead>
<tr>
<th>属性名</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>undefined</td>
</tr>
<tr>
<td>get</td>
<td>undefined</td>
</tr>
<tr>
<td>set</td>
<td>undefined</td>
</tr>
<tr>
<td>writalbe</td>
<td>true</td>
</tr>
<tr>
<td>enumerable</td>
<td>true</td>
</tr>
<tr>
<td>configurable</td>
<td>true</td>
</tr>
</tbody></table>
<p>下面我们来详细了解一下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参数说明：1.对象 2.对象的某个属性 3.对于属性的配置</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'a'</span>,&#123;</span><br><span class="line">	writable:<span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj,<span class="string">'a'</span>));</span><br></pre></td></tr></table></figure>
<p>打开浏览器，按F12，将以上代码粘贴过去，查看控制台内容：</p>
<p><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307130404152.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQyOTcxOA==,size_16,color_FFFFFF,t_70"  alt=""><br>上述，打印的就是我们obj对象中a属性的一系列标签，权限方面可以看到默认的话为true</p>
<p>那么，我们刚刚设置了 writalbe为false，即设置了a属性不可写，进行简单测试一下：<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307130555143.png"  alt=""><br>发现我们无法对a属性进行value的修改，因为将writalbe设置了为false</p>
<p>当然，我们可以设置其他权限标签，例如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参数说明：1.对象 2.对象的某个属性 3.对于属性的配置</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'a'</span>,&#123;</span><br><span class="line">	writable:<span class="literal">false</span>,</span><br><span class="line">	enumerable:<span class="literal">false</span>,</span><br><span class="line">	configurable:<span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj,<span class="string">'a'</span>));</span><br></pre></td></tr></table></figure>
<p>因此，承接上文所述，defineProperty并不是来做响应式的，而是给对象中某个属性设置权限操作，是否可写，是否可以for in，是否可delete</p>
<hr/>

<h4 id="get和set的使用"><a href="#get和set的使用" class="headerlink" title="get和set的使用"></a>get和set的使用</h4><p>Vue中实现双向绑定，其实就是与get和set有很大关系</p>
<p>举个栗子，请看如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参数说明：1.对象 2.对象的某个属性 3.对于属性的配置</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'a'</span>,&#123;</span><br><span class="line">	<span class="keyword">get</span>:function()&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'a is be get!'</span>);</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="keyword">set</span>:function()&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'a is be set!'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj,<span class="string">'a'</span>));</span><br></pre></td></tr></table></figure>
<p>我们在控制台，简单测试一下：<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307131508633.png"  alt=""><br>问题来了，细心的伙伴，应该发现了上图的问题，当我们get的时候，我们返回的是一个undefined，而且我们set一个值之后，也是获取不到新值，依旧是undefined，如下：<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307131752670.png"  alt=""><br>原因呢，其实就是我们的get函数是有返回值的，如果你不return的话，就会默认返回undefined，不管你怎么set都没用，那么如何解决这个问题呢，请看下面代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//借助外部变量存储值</span></span><br><span class="line"><span class="keyword">let</span> _value=obj.a;</span><br><span class="line"><span class="comment">//参数说明：1.对象 2.对象的某个属性 3.对于属性的配置</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'a'</span>,&#123;</span><br><span class="line">	<span class="keyword">get</span>:function()&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'a is be get!'</span>);</span><br><span class="line">		<span class="keyword">return</span> _value;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="keyword">set</span>:function(newVal)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'a is be set!'</span>);</span><br><span class="line">		_value=newVal;</span><br><span class="line">		<span class="keyword">return</span> _value;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj,<span class="string">'a'</span>));</span><br></pre></td></tr></table></figure>
<p>可以看到，我们必须借助一个外部变量，也就是中转站一样，才能达到我们的get和set效果，这也是vue2 中不太优雅的地方</p>
<p>然后，查看控制台，解决了上述问题<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307132357945.png"  alt=""></p>
<h4 id="Vue中从改变一个数据到发生改变的过程"><a href="#Vue中从改变一个数据到发生改变的过程" class="headerlink" title="Vue中从改变一个数据到发生改变的过程"></a>Vue中从改变一个数据到发生改变的过程</h4><p><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307132712267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQyOTcxOA==,size_16,color_FFFFFF,t_70"  alt=""></p>
<h4 id="手写-Vue-2-中响应式原理"><a href="#手写-Vue-2-中响应式原理" class="headerlink" title="手写 Vue 2 中响应式原理"></a>手写 Vue 2 中响应式原理</h4><p>基于上述流程图，我们可以手写一个简单版的Vue2.0实现双向绑定的例子：</p>
<p>这里我就只实现逻辑，不具体去弄视图渲染了</p>
<p><strong>文件名：2.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Vue响应式手写实现</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">vue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.$data=&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;;</span><br><span class="line">	<span class="keyword">this</span>.el=<span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line">	<span class="keyword">this</span>.virtualdom=<span class="string">""</span>;</span><br><span class="line">	<span class="keyword">this</span>.observer(<span class="keyword">this</span>.$data)</span><br><span class="line">	<span class="keyword">this</span>.render();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册get和set监听</span></span><br><span class="line">vue.prototype.observer=<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> value; <span class="comment">//借助外部变量</span></span><br><span class="line">	<span class="keyword">var</span> self=<span class="keyword">this</span>; <span class="comment">//缓存this</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*下面代码 a可能是data里的某个对象，不是属性</span></span><br><span class="line"><span class="comment">	因此在vue2.0中需要for in循环找到属性*/</span></span><br><span class="line">	<span class="comment">//Object.defineProperty(obj,'a') </span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">		value=obj[key];</span><br><span class="line">		<span class="comment">//判断是否为对象</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">typeof</span> value === <span class="string">'object'</span>)&#123;</span><br><span class="line">			<span class="keyword">this</span>.observer(value);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.$data,key,&#123;</span><br><span class="line">				<span class="keyword">get</span>:function()&#123;</span><br><span class="line">					<span class="comment">//进行依赖收集</span></span><br><span class="line">					<span class="keyword">return</span> value;</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="keyword">set</span>:function(newVal)&#123;</span><br><span class="line">					value=newVal;</span><br><span class="line">					<span class="comment">//视图渲染</span></span><br><span class="line">					self.render();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;) </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//更新渲染部分</span></span><br><span class="line">vue.prototype.render=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.virtualdom=<span class="string">"i am "</span>+<span class="keyword">this</span>.$data.a;</span><br><span class="line">	<span class="keyword">this</span>.el.innerHTML=<span class="keyword">this</span>.virtualdom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>文件名：index.html</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">		&lt;title&gt;手写Vue响应式原理&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div id=<span class="string">'app'</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		&lt;script type="text/</span>javascript<span class="string">" src="</span>./<span class="number">2.</span>js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">		&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			var vm = new vue();</span></span><br><span class="line"><span class="string">			//设置set定时器</span></span><br><span class="line"><span class="string">			setTimeout(function()&#123;</span></span><br><span class="line"><span class="string">				console.log('2秒后将值改为123');</span></span><br><span class="line"><span class="string">				console.log(vm.$data);</span></span><br><span class="line"><span class="string">				vm.$data.a=123;</span></span><br><span class="line"><span class="string">			&#125;,2000)</span></span><br><span class="line"><span class="string">		&lt;/script&gt;</span></span><br><span class="line"><span class="string">	&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>查看页面，就会有如下效果：<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307135836555.gif"  alt=""></p>
<p>那么，以后面试如果遇到手写响应式原理，把上述js代码写上去就ok了</p>
<h4 id="源码分析：响应式原理中的依赖收集"><a href="#源码分析：响应式原理中的依赖收集" class="headerlink" title="源码分析：响应式原理中的依赖收集"></a>源码分析：响应式原理中的依赖收集</h4><p>手写的代码里面对于依赖收集这一块我们进行了省略，下面我们从源码的角度去看依赖收集到底是什么玩意：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Define a reactive property on an Object.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defineReactive$$1</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    obj,</span></span></span><br><span class="line"><span class="function"><span class="params">    key,</span></span></span><br><span class="line"><span class="function"><span class="params">    val,</span></span></span><br><span class="line"><span class="function"><span class="params">    customSetter,</span></span></span><br><span class="line"><span class="function"><span class="params">    shallow</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//依赖收集</span></span><br><span class="line">    <span class="keyword">var</span> dep = <span class="keyword">new</span> Dep();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> property = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, key);</span><br><span class="line">    <span class="keyword">if</span> (property &amp;&amp; property.configurable === <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cater for pre-defined getter/setters</span></span><br><span class="line">    <span class="keyword">var</span> getter = property &amp;&amp; property.get;</span><br><span class="line">    <span class="keyword">var</span> setter = property &amp;&amp; property.set;</span><br><span class="line">    <span class="keyword">if</span> ((!getter || setter) &amp;&amp; <span class="built_in">arguments</span>.length === <span class="number">2</span>) &#123;</span><br><span class="line">      val = obj[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> childOb = !shallow &amp;&amp; observe(val);</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>: function reactiveGetter () &#123;</span><br><span class="line">        <span class="keyword">var</span> value = getter ? getter.call(obj) : val;</span><br><span class="line">        <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">		  <span class="comment">//进行依赖收集</span></span><br><span class="line">          dep.depend();</span><br><span class="line">		  </span><br><span class="line">		  <span class="comment">/*采用依赖收集的原因：*/</span></span><br><span class="line">		  </span><br><span class="line">          <span class="comment">//1.data里面的数据并不是所有地方都要用到</span></span><br><span class="line">          <span class="comment">//2.如果我们直接更新整个视图，会造成资源浪费</span></span><br><span class="line">		  <span class="comment">//3.将依赖于某个变量的组件收集起来</span></span><br><span class="line">		  </span><br><span class="line">          <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">            childOb.dep.depend();</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">              dependArray(value);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>: function reactiveSetter (newVal) &#123;</span><br><span class="line">        <span class="keyword">var</span> value = getter ? getter.call(obj) : val;</span><br><span class="line">        <span class="comment">/* eslint-disable no-self-compare */</span></span><br><span class="line">        <span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* eslint-enable no-self-compare */</span></span><br><span class="line">        <span class="keyword">if</span> (customSetter) &#123;</span><br><span class="line">          customSetter();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #7981: for accessor properties without setter</span></span><br><span class="line">        <span class="keyword">if</span> (getter &amp;&amp; !setter) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">          setter.call(obj, newVal);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          val = newVal;</span><br><span class="line">        &#125;</span><br><span class="line">        childOb = !shallow &amp;&amp; observe(newVal);</span><br><span class="line">        dep.notify();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="对依赖收集的总结"><a href="#对依赖收集的总结" class="headerlink" title="对依赖收集的总结"></a>对依赖收集的总结</h4><p>在初次渲染时，会触发一次get函数，为了提高效率，节省资源，采用依赖收集，这里以之前手写的为例，get部分，我们就会对<code>this.$data</code>里的每一个属性（即key值）进行收集，看在哪些组件里进行了调用，以此提高效率。</p>
<p>而在set部分，就会更新我们收集到的依赖 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.$data,key,&#123;</span><br><span class="line">			<span class="keyword">get</span>:function()&#123;</span><br><span class="line">				<span class="comment">//进行依赖收集</span></span><br><span class="line">				<span class="keyword">return</span> value;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="keyword">set</span>:function(newVal)&#123;</span><br><span class="line">				value=newVal;</span><br><span class="line">				<span class="comment">//视图渲染</span></span><br><span class="line">				self.render();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="额外注意——关于数组的监听（探索设计模式）"><a href="#额外注意——关于数组的监听（探索设计模式）" class="headerlink" title="额外注意——关于数组的监听（探索设计模式）"></a>额外注意——关于数组的监听（探索设计模式）</h4><p>从前文我们可以了解到，defineProperty定义的ger和set是对象的属性，那么数组该怎么办呢？</p>
<p>对于数组呢，在Vue中，你是没有办法像C/C++、Java等语言那样直接通过操作下标来触发更新，只能通过push、pop等方法来触发数据更新</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">arr.push(<span class="number">4</span>);</span><br><span class="line">arr.pop();</span><br><span class="line">arr.shift();</span><br></pre></td></tr></table></figure>

<p>这里 <strong><font color=red>特别重要!</font></strong></p>
<p>关于数组这一块里面巧妙运用到了一个设计模式——<font color=blue>装饰者模式</font></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//装饰者模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//先取出原型</span></span><br><span class="line"><span class="keyword">var</span> arraypro=<span class="built_in">Array</span>.prototype;</span><br><span class="line"><span class="comment">//拷贝一份，原因：避免影响到了原来的原型链</span></span><br><span class="line"><span class="keyword">var</span> arrob=<span class="built_in">Object</span>.create(arraypro);</span><br><span class="line"><span class="comment">//定义一个需要装饰的方法的数组，这里只例举以下三个</span></span><br><span class="line"><span class="keyword">var</span> arr=[<span class="string">'push'</span>,<span class="string">'pop'</span>,<span class="string">'shift'</span>];</span><br><span class="line"><span class="comment">//设置重写方法（装饰者模式）</span></span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">methods,index</span>)</span>&#123;</span><br><span class="line">	arrob[method]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">//先调用原来的方法</span></span><br><span class="line">		<span class="keyword">var</span> res=arraypro[method].apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">		<span class="comment">//触发视图更新</span></span><br><span class="line">		dep.notify();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//接下来将数组的prototype替换到data上的prototype(此处省略)</span></span><br><span class="line"><span class="comment">//这样的话，例如我们push方法，既能push又能触发视图更新了</span></span><br></pre></td></tr></table></figure>

<p>对于设计模式呢，其实并不是很难，常说难懂，很难学，可能你学设计模式，你看了书，看到的可能就是简单事例，只是一个用法，没有训练思维，正确的做法是：</p>
<ul>
<li>提高我们的思维，提高代码质量</li>
<li>先学透，记住一些定义和一些具体使用，然后去看，去探索</li>
<li>非常好的一种方式就是结合源码，例如上文我们从Vue数组的监听原理里面剖析出来了装饰者模式</li>
<li>学以致用</li>
</ul>
<h3 id="Vue-3的响应式原理"><a href="#Vue-3的响应式原理" class="headerlink" title="Vue 3的响应式原理"></a>Vue 3的响应式原理</h3><hr/>

<p>对于2.0响应式原理，我们暂告一段落，接下来，我们讨论Vue 3中的技巧，众所周知，Vue 3将<code>defineProperty</code>替换成了<code>proxy</code></p>
<h4 id="什么是proxy"><a href="#什么是proxy" class="headerlink" title="什么是proxy"></a>什么是proxy</h4><p>用于定义基本操作的自定义行为</p>
<blockquote>
<div>和defineProperty类似，功能几乎一样，只不过用法上有所不同</div>
</blockquote>
<p>和上文一样，我们依旧写一个响应式，不过下面的代码是有问题的，读者可以先思考一下。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//无需借助外部变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Proxy</span>(obj,&#123;</span><br><span class="line">	<span class="keyword">get</span>(target,key,receiver)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(target,key,receiver);</span><br><span class="line">		<span class="keyword">return</span> target[key];</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="keyword">set</span>(target,key,value,receiver)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target,key,value);</span><br><span class="line">		<span class="comment">//return target[key]=value;</span></span><br><span class="line">		<span class="comment">/*上面注释的代码和上一行意思相同*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我们在控制台跑一下上述代码，发现它并没有输出console.log的内容，因此是有问题的<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307191318942.png"  alt=""><br>正确代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//无需借助外部变量</span></span><br><span class="line"><span class="comment">//对于vue 2，提高效率，无需for in 遍历找属性</span></span><br><span class="line"><span class="comment">//不会污染原对象，会返回一个新的代理对象，原对象依旧是原对象</span></span><br><span class="line"><span class="comment">//也是软件工程里的重要知识，尽量不要"污染"原对象，不用给原对象做任何操作</span></span><br><span class="line"><span class="comment">//只需对代理对象进行操作</span></span><br><span class="line"><span class="keyword">var</span> objChildren=<span class="keyword">new</span> <span class="built_in">Proxy</span>(obj,&#123;</span><br><span class="line">	<span class="keyword">get</span>(target,key,receiver)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(target,key,receiver);</span><br><span class="line">		<span class="keyword">return</span> target[key];</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="keyword">set</span>(target,key,value,receiver)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target,key,value);</span><br><span class="line">		<span class="comment">//return target[key]=value;</span></span><br><span class="line">		<span class="comment">/*上面注释的代码和上一行意思相同*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="总结：为什么Vue-3中使用proxy"><a href="#总结：为什么Vue-3中使用proxy" class="headerlink" title="总结：为什么Vue 3中使用proxy"></a>总结：为什么Vue 3中使用proxy</h4><ul>
<li>defineProperty只能监听某个属性，不能对全对象进行监听</li>
<li>可以省去for in遍历找对象中的属性，提高效率，省去很多代码</li>
<li>可以监听数组，不用再去单独的对数组进行特异性操作</li>
<li>不会污染原对象，会返回一个新的代理对象，原对象依旧是原对象</li>
<li>只需对代理对象进行操作</li>
</ul>
<h4 id="手写-Vue-3-中响应式原理"><a href="#手写-Vue-3-中响应式原理" class="headerlink" title="手写 Vue 3 中响应式原理"></a>手写 Vue 3 中响应式原理</h4><p>下面代码，是在上文手写 Vue 2 响应式原理基础上修改的，通过对比，可以发现，我们省去了好多代码，不需要进行for in循环比较复杂、耗时间的操作了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Vue响应式手写实现</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">vue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.$data=&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;;</span><br><span class="line">	<span class="keyword">this</span>.el=<span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line">	<span class="keyword">this</span>.virtualdom=<span class="string">""</span>;</span><br><span class="line">	<span class="keyword">this</span>.observer(<span class="keyword">this</span>.$data)</span><br><span class="line">	<span class="keyword">this</span>.render();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册get和set监听</span></span><br><span class="line">vue.prototype.observer=<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> self=<span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">this</span>.$data=<span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="keyword">this</span>.$data,&#123;</span><br><span class="line">		<span class="keyword">get</span>(target,key)&#123;</span><br><span class="line">			<span class="keyword">return</span> target[key];</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="keyword">set</span>(target,key,value)&#123;</span><br><span class="line">			target[key]=value;</span><br><span class="line">			self.render();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//更新渲染部分</span></span><br><span class="line">vue.prototype.render=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.virtualdom=<span class="string">"i am "</span>+<span class="keyword">this</span>.$data.a;</span><br><span class="line">	<span class="comment">//this.el.innerHTML=this.virtualdom;</span></span><br><span class="line">	<span class="keyword">this</span>.el.innerHTML=<span class="keyword">this</span>.virtualdom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看页面，就会有如下效果：<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200307135836555.gif"  alt=""></p>
<h4 id="proxy这么好用，还能做什么呢？（再遇设计模式）"><a href="#proxy这么好用，还能做什么呢？（再遇设计模式）" class="headerlink" title="proxy这么好用，还能做什么呢？（再遇设计模式）"></a>proxy这么好用，还能做什么呢？（再遇设计模式）</h4><p>我们学习知识并不只是为了应付面试那种程度，对于面试应该作为我们的最低要求，接下来，我们接着去深度研究proxy还能干什么呢？</p>
<p>在 Vue 3 基本上已经不兼容IE8了，这里简单提及一下</p>
<ul>
<li><strong>类型验证</strong></li>
</ul>
<p>这里我们就自定义一个实例：创建一个成人的对象，拥有name和age两个属性</p>
<p>要求：name必须是中文，age必须是数字，并且大于18</p>
<p>如果用纯原生js做验证的话，可想有多难去验证上述需求，或许你想到的是在构造函数里面去实现，但也不会简单，那么我们看看proxy怎么实现的：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//类型验证</span></span><br><span class="line"><span class="comment">//外部定义一个验证器对象</span></span><br><span class="line"><span class="keyword">var</span> validator=&#123;</span><br><span class="line">	name:<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> reg=<span class="regexp">/^[\u4E00-\u9FA5]+$/</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">typeof</span> value==<span class="string">'string'</span>&amp;&amp;reg.test(value))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;,</span><br><span class="line">	age:<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">typeof</span> value==<span class="string">'number'</span>&amp;&amp;value&gt;=<span class="number">18</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name=name;</span><br><span class="line">	<span class="keyword">this</span>.age=age;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="keyword">this</span>,&#123;</span><br><span class="line">		<span class="keyword">get</span>(target,key)&#123;</span><br><span class="line">			<span class="keyword">return</span> target[key];</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="keyword">set</span>(target,key,value)&#123;</span><br><span class="line">			<span class="keyword">if</span>(validator[key](value))&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target,key,value);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(key+<span class="string">' is not right!'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里 <strong><font color=red>特别重要!</font></strong></p>
<p>关于类型验证这一块里面又巧妙运用到了一个设计模式——<font color=blue>策略模式</font></p>
<p>关于设计模式这一块，此专栏不会细讲，但会在探索源码时发现了好的实例，会提出来一下。</p>
<p>上述用到了一个正则表达式，关于这个可能面试会问到，这是之前ES 6 里的内容，大家可以看看这篇简单易懂的文章：</p>
<p><a href="https://blog.csdn.net/weixin_42429718/article/details/104591240" target="_blank" rel="noopener">推荐阅读：ES6 面试题：你能说出浏览器上到此支持多少个中文字吗？</a></p>
<ul>
<li><strong>私有变量</strong></li>
</ul>
<p>关于私有变量这一块，我们就拿 <code>vue-router 源码</code>来进行分析：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//vue-router源码分析</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>,<span class="string">'$router'</span>,&#123;<span class="comment">//Router的实例</span></span><br><span class="line">	<span class="keyword">get</span>()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>._root._router;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>,<span class="string">'$route'</span>,&#123;</span><br><span class="line">	<span class="keyword">get</span>()&#123;</span><br><span class="line">		<span class="keyword">return</span>&#123;</span><br><span class="line">			<span class="comment">//当前路由所在的状态</span></span><br><span class="line">			current:<span class="keyword">this</span>._root._router.history.current</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过查看源码，提出疑问：为什么要为<code>$router</code>写get方法呢，而且没做什么操作，只是一个return？</p>
<p>原因：这样可以使得<code>$router</code>不可修改。避免程序员通过set修改了路由，导致路由失效的情况。这里就体现了数据安全思想，前端程序员或许考虑的没有Java程序员多，甚至没有为变量想过某个变量设置不可修改。由于工作的需要，我们也要努力提升自己的代码质量！让自己的职业生涯更加辉煌！</p>
<h3 id="virtual-dom-和-diff算法"><a href="#virtual-dom-和-diff算法" class="headerlink" title="virtual dom 和 diff算法"></a>virtual dom 和 diff算法</h3><hr/>

<p>关于diff算法和虚拟dom，也是面试常见的问题，平常容易忽视，这里我也就深入研究了一下：</p>
<h4 id="虚拟dom"><a href="#虚拟dom" class="headerlink" title="虚拟dom"></a>虚拟dom</h4><p>所谓虚拟dom，如字面意思，它是虚拟的，只在概念里面存在，并不真的存在，在vue中是ast语法树，关于这个语法树本文就不详细介绍了，有兴趣的读者可以深入研究一下。</p>
<p>下面代码，是一个简单vue template模板，那么解析成虚拟dom是怎样的呢？</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div id=<span class="string">'dd'</span>&gt;</span><br><span class="line">		&lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">		&lt;p&gt;abc&lt;/</span>p&gt;</span><br><span class="line">		&lt;p&gt;<span class="number">123</span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>

<p>解析成虚拟dom：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">diff &lt;div&gt;</span><br><span class="line">	props:&#123;</span><br><span class="line">		id:dd</span><br><span class="line">	&#125;,</span><br><span class="line">	children:[</span><br><span class="line">		diff &lt;p&gt;</span><br><span class="line">		props:</span><br><span class="line">		children:[</span><br><span class="line">			</span><br><span class="line">		],</span><br><span class="line">		text:xxx,</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<p>上述代码就是概念上的介绍，如果懂一点算法知识的应该就明白了，就是不断地嵌套，但为了让更多伙伴读懂学会虚拟dom，下面来手写一个对象的形式：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div id=<span class="string">'dd'</span>&gt;</span><br><span class="line">		&lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">		&lt;p&gt;abc&lt;/</span>p&gt;</span><br><span class="line">		&lt;p&gt;<span class="number">123</span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var virtual=</span></span><br><span class="line"><span class="regexp">&#123;</span></span><br><span class="line"><span class="regexp">	dom:'div',</span></span><br><span class="line"><span class="regexp">	props:&#123;</span></span><br><span class="line"><span class="regexp">		id:dd</span></span><br><span class="line"><span class="regexp">	&#125;,</span></span><br><span class="line"><span class="regexp">	children:[</span></span><br><span class="line"><span class="regexp">		&#123;</span></span><br><span class="line"><span class="regexp">			dom:'p',</span></span><br><span class="line"><span class="regexp">			children:[</span></span><br><span class="line"><span class="regexp">				dom:'span',</span></span><br><span class="line"><span class="regexp">				children:[]</span></span><br><span class="line"><span class="regexp">			]</span></span><br><span class="line"><span class="regexp">		&#125;,</span></span><br><span class="line"><span class="regexp">		&#123;</span></span><br><span class="line"><span class="regexp">			dom:'p',</span></span><br><span class="line"><span class="regexp">			children:[</span></span><br><span class="line"><span class="regexp">			]</span></span><br><span class="line"><span class="regexp">		&#125;,</span></span><br><span class="line"><span class="regexp">		&#123;</span></span><br><span class="line"><span class="regexp">			dom:'p',</span></span><br><span class="line"><span class="regexp">			children:[</span></span><br><span class="line"><span class="regexp">			]</span></span><br><span class="line"><span class="regexp">		&#125;</span></span><br><span class="line"><span class="regexp">	]</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上述代码应该就很清晰了，简单来说，就是将最上面的dom结构，解析成下面用js解析成的对象，每一个对象都有一个基础的结构：</p>
<ul>
<li>dom元素标签</li>
<li>props记录挂载了哪些属性</li>
<li>children记录有哪些子元素（子元素拥有和父元素相同的结构）</li>
</ul>
<h4 id="diff算法的比对机制"><a href="#diff算法的比对机制" class="headerlink" title="diff算法的比对机制"></a>diff算法的比对机制</h4><p>下面部分采用了伪代码形式介绍diff算法的比对机制，已经给出了详细的注释说明：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//diff算法匹配机制</span></span><br><span class="line">patchVnode(oldVnode,vnode)&#123;</span><br><span class="line">	<span class="comment">//先拿到真实的dom</span></span><br><span class="line">	<span class="keyword">const</span> el=vnode.el=oldVnode.el;</span><br><span class="line">	<span class="comment">//分别拿出旧节点和新节点的子元素</span></span><br><span class="line">	<span class="keyword">let</span> i,oldCh=oldVnode.children,ch=vnode.children;</span><br><span class="line">	<span class="comment">//如果新旧节点相同，直接return</span></span><br><span class="line">	<span class="keyword">if</span>(oldVnode==vnode) <span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">/*分四种情况讨论*/</span></span><br><span class="line">	<span class="comment">//1.只有文字节点不同的情况</span></span><br><span class="line">	<span class="keyword">if</span>(oldVnode.text!==<span class="literal">null</span>&amp;&amp;vnode.text!==<span class="literal">null</span>&amp;&amp;oldVnode.text!==vnode.text)&#123;</span><br><span class="line">		api.setTextContent(el,vnode.text);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		updateEle();</span><br><span class="line">		<span class="comment">//2.如果新旧节点的子元素都存在，那么发生的是子元素变动</span></span><br><span class="line">		<span class="keyword">if</span>(oldCh&amp;&amp;ch&amp;&amp;oldCh!==ch)&#123;</span><br><span class="line">			updateChildren();</span><br><span class="line">		<span class="comment">//3.如果只有新节点有子元素，那么发生的是新增子元素</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ch)&#123;</span><br><span class="line">			createEl(vnode);</span><br><span class="line">		<span class="comment">//4.如果只有旧节点有子元素，那么发生的是新节点删除了子元素</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldCh)&#123;</span><br><span class="line">			api.removeChildren(el);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">学如逆水行舟，不进则退</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Yang Chao Yi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yangchaoyi.vip/posts/37332/">https://yangchaoyi.vip/posts/37332/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yangchaoyi.vip" target="_blank">超逸の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Vue/">Vue</a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161711.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/20541/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161726.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">前端知识梳理之webpack篇</div></div></a></div><div class="next-post pull_right"><a href="/posts/35726/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161732.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo 添加加载动画</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/205511/" title="前端知识梳理之Vue篇"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161711.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-05</div><div class="relatedPosts_title">前端知识梳理之Vue篇</div></div></a></div><div class="relatedPosts_item"><a href="/posts/20542/" title="前端知识梳理之HTML篇"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161709.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">前端知识梳理之HTML篇</div></div></a></div><div class="relatedPosts_item"><a href="/posts/20541/" title="前端知识梳理之webpack篇"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161726.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">前端知识梳理之webpack篇</div></div></a></div><div class="relatedPosts_item"><a href="/posts/35725/" title="【Vue全家桶+SSR+Koa2全栈开发】项目搭建过程  整合  学习目录（持续更新中）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/018.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">【Vue全家桶+SSR+Koa2全栈开发】项目搭建过程  整合  学习目录（持续更新中）</div></div></a></div><div class="relatedPosts_item"><a href="/posts/34924/" title="2020 零基础到快速开发  Vue全家桶开发电商管理系统（Element-UI）【目录】"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/019.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">2020 零基础到快速开发  Vue全家桶开发电商管理系统（Element-UI）【目录】</div></div></a></div><div class="relatedPosts_item"><a href="/posts/vue-family/" title="前端全家桶（面试题大整理）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/023.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">前端全家桶（面试题大整理）</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论<a id="switch-comment" href="javascript:void(0);" title="切换为Gitalk" target="_self"><i class="fa fas fa-toggle-off" aria-hidden="true"></i></a></span></div><div id="gitalk-container" style="display:none;"></div><script>var gitalk = new Gitalk({
  clientID: 'fbfdeac3b5cb0daad093',
  clientSecret: 'daa19d006003e415e226613ebb71a8c1d885b4b3',
  repo: 'chocolate1999.github.io',
  owner: 'Chocolate1999',
  admin: ['Chocolate1999'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: true,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: true,
  appId: 'MyJU2hPYwmGOX83xvElhQWR1-MdYXbMMI',
  appKey: 'ceIoRkQFQY9lYi6NDekB5v4Y',
  placeholder: '小狮子，留下你的足迹吧（↑邮箱必填），你也可以在左上角切换Gitalk评论~',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: '',
  //tagMeta: '',
  master: '00b6017552f79cce0e8d634fdfb77d05',
  friends: '0c164af184c4f776d83b0e98f08b5767,7bf23e76ba3518b54eab1821a6821eb1,d36ba977a9765379c3e78d1a59701319,ac4376986fcb5a84e17f47b641c50a69'
});</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/npm/blog-gallery@1.0.0/1/20200206161739.webp)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Yang Chao Yi</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>湘ICP备20002952号</span></a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 4.2.0"></head></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/js/third-party/switch_comments.js"></script><script src="/js/third-party/Valine.min.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>